<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Google Task Manager</title>
<style>
  :root {
    --glass-bg: rgba(255, 255, 255, 0.1);
    --glass-border: rgba(255, 255, 255, 0.25);
    --accent: #7f5af0;
    --accent-light: #9e8df5;
  }
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0f172a, #1e293b);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
    min-height: 100vh;
  }
  .container {
    width: 100%;
    max-width: 500px;
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    border: 1px solid var(--glass-border);
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
  }
  #taskInput {
    width: calc(100% - 90px);
    padding: 0.6rem;
    border-radius: 8px;
    border: none;
    margin-right: 0.5rem;
    outline: none;
  }
  button {
    background: var(--accent);
    border: none;
    padding: 0.6rem 1rem;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    transition: 0.2s;
  }
  button:hover {
    background: var(--accent-light);
  }
  ul {
    list-style: none;
    padding: 0;
    margin-top: 1rem;
  }
  li {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(255,255,255,0.05);
    padding: 0.6rem 0.8rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
  }
  .task-left {
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }
  input[type="checkbox"] {
    accent-color: var(--accent);
    transform: scale(1.3);
  }
  .completed {
    text-decoration: line-through;
    opacity: 0.7;
  }
</style>
</head>
<body>

<div class="container">
  <h1>Task Manager</h1>
  <div id="loginSection">
    <button id="loginBtn">Sign in with Google</button>
  </div>

  <div id="taskSection" style="display:none;">
    <div style="display:flex; margin-bottom:1rem;">
      <input type="text" id="taskInput" placeholder="New task..." />
      <button id="addTaskBtn">Add</button>
    </div>
    <ul id="taskList"></ul>
    <button id="logoutBtn" style="margin-top:1rem; background:#f87171;">Logout</button>
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

<script>
  // 1️⃣ Firebase Config
  const firebaseConfig = {
  apiKey: "AIzaSyAYYq3uWBzUfuVX5H6dzadmRzqRrvNk-3o",
  authDomain: "glasstask-f4a65.firebaseapp.com",
  projectId: "glasstask-f4a65",
  storageBucket: "glasstask-f4a65.firebasestorage.app",
  messagingSenderId: "512175308976",
  appId: "1:512175308976:web:0d1710528a983cd4133b75",
  measurementId: "G-EB1T4LSXG4"
};

  // 2️⃣ Init Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const taskSection = document.getElementById("taskSection");
  const loginSection = document.getElementById("loginSection");
  const taskList = document.getElementById("taskList");
  const addTaskBtn = document.getElementById("addTaskBtn");
  const taskInput = document.getElementById("taskInput");

  let currentUser = null;

  // 3️⃣ Login with Google
  loginBtn.addEventListener("click", async () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    try {
      await auth.signInWithPopup(provider);
    } catch (err) {
      console.error(err);
    }
  });

  // 4️⃣ Logout
  logoutBtn.addEventListener("click", async () => {
    await auth.signOut();
  });

  // 5️⃣ Auth State Change
  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      loginSection.style.display = "none";
      taskSection.style.display = "block";
      loadTasks();
    } else {
      currentUser = null;
      taskList.innerHTML = "";
      loginSection.style.display = "block";
      taskSection.style.display = "none";
    }
  });

  // 6️⃣ Load Tasks
  async function loadTasks() {
    taskList.innerHTML = "";
    const snapshot = await db.collection("users").doc(currentUser.uid).collection("tasks").get();
    snapshot.forEach(doc => {
      renderTask(doc.id, doc.data().text, doc.data().completed);
    });
  }

  // 7️⃣ Add Task
  addTaskBtn.addEventListener("click", async () => {
    const text = taskInput.value.trim();
    if (!text) return;
    const docRef = await db.collection("users").doc(currentUser.uid).collection("tasks").add({
      text,
      completed: false
    });
    renderTask(docRef.id, text, false);
    taskInput.value = "";
  });

  // 8️⃣ Render Task
  function renderTask(id, text, completed) {
    const li = document.createElement("li");
    const left = document.createElement("div");
    left.className = "task-left";

    const checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.checked = completed;
    checkbox.addEventListener("change", () => {
      db.collection("users").doc(currentUser.uid).collection("tasks").doc(id).update({
        completed: checkbox.checked
      });
      span.classList.toggle("completed", checkbox.checked);
    });

    const span = document.createElement("span");
    span.textContent = text;
    if (completed) span.classList.add("completed");

    left.appendChild(checkbox);
    left.appendChild(span);

    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.style.background = "#ef4444";
    delBtn.addEventListener("click", () => {
      db.collection("users").doc(currentUser.uid).collection("tasks").doc(id).delete();
      li.remove();
    });

    li.appendChild(left);
    li.appendChild(delBtn);
    taskList.appendChild(li);
  }
</script>

</body>
</html>
